# 1C AI Feature Dev Workflow

Воркфлоу для разработки доработок в **существующей** конфигурации 1С:Предприятие. Анализирует кодовую базу, проектирует архитектуру, пишет код с соблюдением стандартов и проверяет качество.

## Для чего

Набор агентов помогает дорабатывать **уже существующую** конфигурацию 1С:
- Изучает существующие паттерны и архитектуру
- Предлагает варианты реализации с учётом вашей кодовой базы
- Пишет код, который соответствует вашим стандартам
- Проверяет код на баги и соответствие правилам проекта

## Команда

```bash
/1c-feature-dev Добавить интеграцию с API складской системы
```

## Воркфлоу (7 фаз)

### Фаза 1: Discovery
Уточнение задачи — что нужно построить. Если запрос неясен, задаются вопросы о проблеме, требованиях и ограничениях.

### Фаза 2: Исследование кодовой базы
Запускаются **3 агента `1c-code-explorer` параллельно** для анализа разных аспектов:
- Похожие доработки и их реализация
- Архитектура и абстракции в области доработки
- Текущая реализация существующей функциональности

Агенты возвращают список ключевых файлов для чтения и сводку найденных паттернов.

### Фаза 3: Уточняющие вопросы
На основе найденного выявляются неоднозначности: граничные случаи, обработка ошибок, точки интеграции, производительность. Все вопросы представляются списком, **ждём ответов пользователя перед проектированием**.

### Фаза 4: Архитектура
Запускаются **3 агента `1c-code-architect` параллельно** с разным фокусом:
- **Минимальные изменения** — наименьшее изменение, максимальное переиспользование
- **Чистая архитектура** — поддерживаемость, элегантные абстракции
- **Прагматичный баланс** — скорость + качество

Представляются все подходы с компромиссами и рекомендацией. Пользователь выбирает подход, создаётся файл плана `.tasks/task-[name]/plan.md`.

### Фаза 5: Реализация
Запускается агент `1c-code-writer` для реализации по выбранному архитектурному подходу. **Только после явного одобрения пользователя.**

### Фаза 6: Проверка качества
Запускаются **3 агента `1c-code-reviewer` параллельно** с разным фокусом:
- Простота/DRY/элегантность
- Баги/функциональная корректность
- Соглашения проекта/абстракции

Проблемы группируются по важности. Пользователь решает: исправить сейчас, исправить позже или продолжить как есть. При исправлении — итерация повторяется.

### Фаза 7: Итоги
Документирование изменений: что построено, ключевые решения, изменённые файлы, следующие шаги.

## Агенты

| Агент | Назначение |
|-------|------------|
| `1c-code-explorer` | Анализ существующей кодовой базы, трассировка выполнения |
| `1c-code-architect` | Проектирование архитектуры с учётом паттернов проекта |
| `1c-code-writer` | Написание кода по стандартам из `1c-rules.md` |
| `1c-code-reviewer` | Проверка кода на баги и соответствие стандартам |

## Использование агентов отдельно

Не обязательно запускать полный воркфлоу — агенты можно использовать по отдельности:

```bash
# Только исследовать код
"Запусти 1c-code-explorer для анализа того, как работает авторизация"

# Только спроектировать
"Запусти 1c-code-architect для проектирования слоя кеширования"

# Только написать код
"Запусти 1c-code-writer для реализации процедуры XYZ"

# Только проверить код
"Запусти 1c-code-reviewer для проверки моих последних изменений"
```

## Пример диалога

```
Вы: /1c-feature-dev Добавить интеграцию с API складской системы

[Фаза 1: Discovery]
Claude: Давайте уточню задачу...
      - Какая складская система? (WMS, 1С:Компаунд, собственная?)
      - Что передавать? (остатки, поступления, отгрузки)
      - В какую сторону? (из 1С, в 1С, обе)
      - Какой протокол? (REST API, SOAP, обмен файлами)

Вы: WMS система, остатки и поступления, из WMS в 1С, REST API

[Фаза 2: Исследование]
Найдены похожие доработки:
- ОбщиеМодули/ИнтеграцияHTTP.bsl — уже есть клиент HTTP
- ОбщиеМодули/ОбменДаннымиСервер.bsl — обработчики пакетов обмена
- Справочники.Номенклатура — есть реквизит Артикул для маппинга

[Фаза 3: Уточняющие вопросы]
Уточню детали реализации:
1. Какая периодичность опроса? (по расписанию, в реальном времени)
2. Что делать при несовпадении данных? (перезаписывать, спрашивать)
3. Нужно ли логирование всех запросов/ответов?

Вы: По расписанию каждые 5 минут, перезаписывать, да логировать

[Фаза 4: Архитектура]
Спроектированы 3 подхода:

**Подход 1: Минимальные изменения**
Добавить регламентное задание с вызовом HTTP напрямую.
- Плюсы: быстро, минимум кода
- Минусы: сложнее тестировать, нет переиспользования

**Подход 2: Через существующий ИнтеграцияHTTP** ⭐ Рекомендую
Создать менеджер интеграции WMS поверх существующего HTTP-клиента.
- Плюсы: единый стиль, простое тестирование, переиспользование
- Минусы: нужно изучить API ИнтеграцияHTTP

**Подход 3: Чистая архитектура**
Выделить в отдельную подсистему "ИнтеграцияWMS" с абстракциями.
- Плюсы: максимально чистое разделение, легко масштабировать
- Минусы: много кода, избыточно для одной точки обмена

Какой подход выбираем?

Вы: Подход 2

✓ План сохранён в .tasks/task-integraciya-wms/plan.md
  (можно вернуться к задаче позже)

Готово начать реализацию? Одобрите план.

Вы: Да, приступаем

[Фаза 5: Реализация]
✓ Код написан

[Фаза 6: Проверка]
Найдено 2 проблемы:
1. Отсутствует обработка таймаута при вызове API — критично
2. Логирование не работает при ошибках авторизации — некритично

Исправить сейчас обе?

Вы: Только первую

✓ Исправлено

[Фаза 7: Итоги]
Готово! Созданы:
- ОбщиеМодули/ИнтеграцияWMSСервер.bsl
- РегламентныеЗадания.ОбменСWMS
- Обработки.ЖурналОбменаСWMS
```

## Установка

Скопируйте файлы агентов, скиллов и правил в соответствующую директорию вашего LLM-инструмента. Пути могут отличаться:

**Для Claude Code:**
```bash
cp agents/*.md ~/.claude/agents/
cp -r skills/1c-ai-feature-dev-workflow ~/.claude/skills/
cp rules/1c-rules.md ~/.claude/rules/
```

**Для других инструментов:** сверьтесь с документацией по установке агентов.

> **Примечание для не Claude Code:**
> В агентах используются специфичные для Claude Code пути:
> - `~/.claude/` — замените на директорию вашего инструмента
> - `~/.claude/rules/1c-rules.md` — ваш файл с правилами кодирования
> - `CLAUDE.md` — ваш файл с правилами проекта (может называться `AGENTS.md` и др.)
>
> В начале файлов агентов находятся YAML-блоки с метаданными, специфичные для Claude Code. Адаптируйте их под ваш инструмент или удалите, если не нужны.

## Кастомизация

Этот проект можно использовать как **базу для построения собственного workflow**. Все компоненты адаптируемы под ваши задачи:

### Изменение промптов агентов

Промпты каждого агента находятся в файлах `agents/*.md`. Вы можете:
- Добавить или убрать инструкции под свой стиль работы
- Изменить формат вывода результатов
- Добавить специфичные для вашей конфигурации паттерны

### Адаптация правил

Файл `rules/1c-rules.md` содержит стандарты кодирования. Вы можете:
- Добавить свои правила форматирования
- Указать специфичные для вашего проекта соглашения об именовании
- Добавить требования к документации

### Модификация скилла

Основной workflow определён в `skills/1c-ai-feature-dev-workflow/SKILL.md`:
- **Добавление фаз** — вставьте новую фазу в нужное место воркфлоу
- **Удаление фаз** — уберите ненужные этапы
- **Изменение логики** — поменяйте порядок фаз или условия переходов между ними

### Добавление новых агентов

Создайте файл `agents/my-agent.md` по аналогии с существующими:

```markdown
---
name: my-agent
description: "Краткое описание назначения агента"
model: opus
color: blue
---

Ты — эксперт в области X. Твоя задача — ...
```

Затем используйте агента в скилле через текстовые команды:

```markdown
Запусти агента `my-agent` для анализа ...
```

## Когда использовать

**Доработки в существующей конфигурации**:
- Расширение функциональности
- Интеграции с внешними системами
- Сложная бизнес-логика
- Неясные требования

**Не для простых задач**:
- Однострочные исправления
- Тривиальные изменения
- Срочные хотфиксы

## Требования

- LLM-инструмент с поддержкой субагентов (Claude Code и др.)
- Конфигурация 1С, выгруженная в файлы
- MCP-сервер справки 1С (опционально, используется агентами `1c-code-writer` и `1c-code-reviewer` для проверки синтаксиса и т.д.)

## Особенности

- **План сохраняется в файл** `.tasks/task-[name]/plan.md` — можно вернуться к задаче позже
- **Итеративное ревью** — пишем → проверяем → исправляем → повторяем

## Происхождение

Адаптация воркфлоу [feature-dev](https://github.com/anthropics/claude-plugins-official/tree/main/plugins/feature-dev) от Anthropic для платформы 1С:Предприятие.

## Автор

Andreev Evgeniy

## Лицензия

MIT License — см. [LICENSE](LICENSE)
